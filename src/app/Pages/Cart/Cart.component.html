<div class="cart-page"
    *ngIf="(embryoService.localStorageCartProducts && embryoService.localStorageCartProducts.length>0); else elseBlock">
    <div class="container">
        <div class="cart-header">
            <h1 class="cart-title">Tu Carrito</h1>
            <div class="cart-count">{{embryoService.localStorageCartProducts.length}} productos</div>
        </div>

        <div class="cart-content">
            <div class="products-section">
                <div class="cart-table-header">
                    <div class="col-product">Producto</div>
                    <div class="col-price">Precio</div>
                    <div class="col-quantity">Cantidad</div>
                    <div class="col-total">Total</div>
                    <div class="col-remove"></div>
                </div>

                <div class="product-card" *ngFor="let product of embryoService.localStorageCartProducts; let i = index">

                    <div class="product-col-main">
                        <div class="product-image-container">
                            <img class="product-image" [src]="product.image" [alt]="product.name" loading="lazy">
                        </div>
                    </div>

                    <div class="product-info">
                        <h3 class="product-name">{{product?.name}}</h3>
                        <span class="unit-price mobile-only">{{product.price | currency : 'USD' : 'symbol' :
                            '1.0-0'}}</span>
                    </div>

                    <div class="product-col-price desktop-only">
                        <span>{{product.price | currency : 'USD' : 'symbol' : '1.0-0'}}</span>
                    </div>

                    <div class="product-col-quantity">
                        <div class="quantity-controls"
                            [class.updating]="updatingProductId === (product.id_product || product.id)">
                            <button type="button" class="qty-btn minus" (click)="decrement(product)"
                                [disabled]="getQuantityValue(product) <= 1 || isUpdating">
                                <span>−</span>
                            </button>
                            <span class="qty-display">
                                <span *ngIf="updatingProductId === (product.id_product || product.id)"
                                    class="loading-spinner"></span>
                                <span
                                    *ngIf="updatingProductId !== (product.id_product || product.id)">{{getQuantityValue(product)}}</span>
                            </span>
                            <button type="button" class="qty-btn plus" (click)="increment(product)"
                                [disabled]="getQuantityValue(product) >= 10 || isUpdating">
                                <span>+</span>
                            </button>
                        </div>
                    </div>

                    <div class="product-col-total desktop-only">
                        <span>{{ calculateProductSinglePrice(product, getQuantityValue(product)) | currency : 'USD' :
                            'symbol' : '1.0-0'}}</span>
                    </div>

                    <div class="product-col-total-mobile mobile-only">
                        <span>{{ calculateProductSinglePrice(product, getQuantityValue(product)) | currency : 'USD' :
                            'symbol' : '1.0-0'}}</span>
                    </div>

                    <div class="product-col-remove">
                        <button type="button" class="remove-btn" (click)="removeProduct(product)">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="3 6 5 6 21 6"></polyline>
                                <path
                                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                </path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <div class="cart-summary">
                <div class="summary-details">
                    <div class="summary-row total-row">
                        <span class="label">Total a pagar</span>
                        <span class="total-amount">{{getTotalPrice() | currency : 'USD' : 'symbol' : '1.0-0'}}</span>
                    </div>
                </div>

                <button class="pay-button" (click)="updateLocalCartProduct()">
                    <div class="pay-button-content">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z">
                            </path>
                        </svg>
                        <span>Pagar {{getTotalPrice() | currency : 'USD' : 'symbol' : '1.0-0'}}</span>
                    </div>
                    <div class="pay-button-security">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M10,17L6,13L7.41,11.59L10,14.17L16.59,7.58L18,9L10,17Z">
                            </path>
                        </svg>
                        <span>Pago seguro</span>
                    </div>
                </button>
            </div>
        </div>
    </div>
</div>
<ng-template #elseBlock>
    <div class="empty-cart-state">
        <div class="empty-cart-content">
            <h2 class="empty-cart-title">Tu carrito está vacío</h2>
        </div>
    </div>
</ng-template>