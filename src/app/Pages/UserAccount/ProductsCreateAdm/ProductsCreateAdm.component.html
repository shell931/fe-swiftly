<div class="product-create-container">
    <div class="create-header">
        <div class="header-content">
            <b>Crear Producto</b>
            <span class="create-status">Diligencia el formulario para añadir un nuevo producto a tu tienda</span>
        </div>
    </div>

    <!-- Spinner de carga -->
    <div class="overlay-spinner" *ngIf="show">
        <mat-progress-spinner diameter="50" mode="indeterminate" color="accent"></mat-progress-spinner>
    </div>

    <div class="create-content-grid">
        <!-- COLUMNA IZQUIERDA: Formulario -->
        <div class="form-card">
            <form [formGroup]="productForm" class="create-form">

                <!-- Fila 1: Nombre y Código -->
                <div class="form-row">
                    <div class="form-group">
                        <label>Nombre <span class="required">*</span></label>
                        <input placeholder="Nombre del producto" formControlName="name_product" class="form-control"
                            required maxlength="100">
                        <mat-error
                            *ngIf="productForm.get('name_product').hasError('required') && productForm.get('name_product').touched">
                            Requerido
                        </mat-error>
                    </div>

                    <div class="form-group">
                        <label>Código (EAN/UPC) <span class="required">*</span></label>
                        <input placeholder="Código único" formControlName="product_code" class="form-control" required
                            maxlength="100">
                        <mat-error
                            *ngIf="productForm.get('product_code').hasError('required') && productForm.get('product_code').touched">
                            Requerido
                        </mat-error>
                    </div>
                </div>

                <!-- Fila 2: Disponibilidad y Stock -->
                <div class="form-row">
                    <div class="form-group">
                        <label>Disponible <span class="required">*</span></label>
                        <ng-select formControlName="availa" [(ngModel)]="selectedAvaila" required
                            placeholder="Seleccionar" [clearable]="false">
                            <ng-option [value]="true">Sí</ng-option>
                            <ng-option [value]="false">No</ng-option>
                        </ng-select>
                        <mat-error
                            *ngIf="productForm.get('availa').hasError('required') && productForm.get('availa').touched">
                            Requerido
                        </mat-error>
                    </div>

                    <div class="form-group">
                        <label>Stock <span class="required">*</span></label>
                        <input placeholder="0" formControlName="stock" class="form-control" required type="number">
                        <mat-error
                            *ngIf="productForm.get('stock').hasError('required') && productForm.get('stock').touched">
                            Requerido
                        </mat-error>
                    </div>
                </div>

                <!-- Fila 3: Categoría y Subcategoría -->
                <div class="form-row">
                    <div class="form-group">
                        <label>Categoría <span class="required">*</span></label>
                        <ng-select [items]="prod_category$ | async" bindLabel="name_category" bindValue="id"
                            [formControl]="categoryFilterCtrl" formControlName="categoryCtrl"
                            (change)="subcategoriesChangeAction($event)" [(ngModel)]="selectedProdCate" required
                            placeholder="Buscar categoría...">
                        </ng-select>
                        <mat-error
                            *ngIf="productForm.get('categoryCtrl').hasError('required') && productForm.get('categoryCtrl').touched">
                            Requerido
                        </mat-error>
                    </div>

                    <div class="form-group">
                        <label>Subcategoría <span class="required">*</span></label>
                        <ng-select [items]="sub_catego$ | async" bindLabel="name_subcategory" bindValue="id"
                            [formControl]="subcategoryFilterCtrl" formControlName="subcategoryCtrl"
                            [(ngModel)]="selectedSubcategory" required placeholder="Buscar subcategoría...">
                        </ng-select>
                        <mat-error
                            *ngIf="productForm.get('subcategoryCtrl').hasError('required') && productForm.get('subcategoryCtrl').touched">
                            Requerido
                        </mat-error>
                    </div>
                </div>

                <!-- Fila 4: Marca y Precio -->
                <div class="form-row">
                    <div class="form-group">
                        <label>Marca <span class="required">*</span></label>
                        <input placeholder="Marca del producto" formControlName="brand" class="form-control" required
                            maxlength="100">
                        <mat-error
                            *ngIf="productForm.get('brand').hasError('required') && productForm.get('brand').touched">
                            Requerido
                        </mat-error>
                    </div>

                    <div class="form-group">
                        <label>Precio <span class="required">*</span></label>
                        <input placeholder="$ 0.00" formControlName="total_price" class="form-control" required
                            type="number">
                        <mat-error
                            *ngIf="productForm.get('total_price').hasError('required') && productForm.get('total_price').touched">
                            Requerido
                        </mat-error>
                    </div>
                </div>

                <!-- Fila 5: Descripción -->
                <div class="form-row full">
                    <div class="form-group">
                        <label>Descripción <span class="required">*</span></label>
                        <textarea placeholder="Detalles del producto..." formControlName="description_product"
                            class="form-control textarea" required maxlength="500" rows="4"></textarea>
                        <mat-error
                            *ngIf="productForm.get('description_product').hasError('required') && productForm.get('description_product').touched">
                            Requerido
                        </mat-error>
                    </div>
                </div>

                <!-- Botón Acción -->
                <div class="form-actions">
                    <button class="create-btn" mat-raised-button (click)="submitProductInfo()" [disabled]="btnDisabled">
                        <i class="material-icons">add_circle_outline</i>
                        Crear Producto
                    </button>
                </div>
            </form>
        </div>

        <!-- COLUMNA DERECHA: Imágenes -->
        <div class="images-card">
            <label class="section-label">Imágenes del Producto</label>

            <div class="dropzone-wrapper">
                <ngx-dropzone (change)="selectFile($event)" [multiple]="true" [expandable]="true" [disableClick]="false"
                    [accept]="'image/*'" [maxFileSize]="1000000" class="custom-dropzone">

                    <ngx-dropzone-label>
                        <div class="dropzone-content">
                            <i class="material-icons">cloud_upload</i>
                            <p>Subir imágenes</p>
                            <small>JPG, PNG | Max 1MB</small>
                        </div>
                    </ngx-dropzone-label>

                    <ngx-dropzone-image-preview ngProjectAs="ngx-dropzone-preview" *ngFor="let f of files" [file]="f"
                        [removable]="true" (removed)="onRemove(f)">
                    </ngx-dropzone-image-preview>
                </ngx-dropzone>
            </div>

            <div class="validation-msg" *ngIf="validate_img">
                <i class="material-icons">warning</i>
                <span>Mínimo 700x700px requeridos.</span>
            </div>
            <div class="validation-msg error" *ngIf="obligatory_img">
                <i class="material-icons">error</i>
                <span>Sube al menos una imagen.</span>
            </div>
        </div>
    </div>
</div>