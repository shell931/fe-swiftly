<div class="product-create-container">
    <div class="product-create-header">
        <div class="header-content">
            <b>Crear producto</b>
            <span class="create-status">Agrega un nuevo producto a tu tienda</span>
        </div>
        <a class="back-link" routerLink="/account/product_adm">
            <i class="material-icons">arrow_back</i>
            Volver a productos
        </a>
    </div>

    <div class="product-create-content">
        <form [formGroup]="productForm" class="product-create-form">
            <div class="form-container">
                <div class="form-row">
                    <div class="form-group">
                        <label>Nombre <span class="required">*</span></label>
                        <input placeholder="Nombre del producto" 
                               formControlName="name_product" 
                               class="form-control" 
                               required 
                               maxlength="40">
                        <mat-error *ngIf="productForm.get('name_product').hasError('required') && productForm.get('name_product').touched">
                            Este campo es obligatorio.
                        </mat-error>
                    </div>
                    
                    <div class="form-group">
                        <label>Código (EAN, UPC, GTIN) <span class="required">*</span></label>
                        <input placeholder="Código del producto" 
                               formControlName="product_code" 
                               class="form-control" 
                               maxlength="14" 
                               required>
                        <mat-error *ngIf="productForm.get('product_code').hasError('required') && productForm.get('product_code').touched">
                            Este campo es obligatorio.
                        </mat-error>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Disponible <span class="required">*</span></label>
                        <ng-select formControlName="availa" 
                                   [(ngModel)]="selectedAvaila" 
                                   required
                                   placeholder="Seleccionar disponibilidad">
                            <ng-option [value]="true">Sí</ng-option>
                            <ng-option [value]="false">No</ng-option>
                        </ng-select>
                        <mat-error *ngIf="productForm.get('availa').hasError('required') && productForm.get('availa').touched">
                            Este campo es obligatorio.
                        </mat-error>
                    </div>
                    
                    <div class="form-group">
                        <label>Stock <span class="required">*</span></label>
                        <input placeholder="Cantidad en stock" 
                               formControlName="stock" 
                               class="form-control" 
                               required 
                               type="text" 
                               maxlength="7">
                        <mat-error *ngIf="productForm.get('stock').hasError('required') && productForm.get('stock').touched">
                            Este campo es obligatorio.
                        </mat-error>
                        <mat-error *ngIf="productForm.controls['stock'].hasError('pattern')">
                            Solo se aceptan números.
                        </mat-error>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Categoría <span class="required">*</span></label>
                        <ng-select [items]="prod_category$ | async" 
                                   bindLabel="name_category" 
                                   bindValue="id" 
                                   [formControl]="categoryFilterCtrl" 
                                   formControlName="categoryCtrl" 
                                   (change)="subcategoriesChangeAction($event)" 
                                   [(ngModel)]="selectedProdCate" 
                                   required
                                   placeholder="Seleccionar categoría">
                        </ng-select>
                        <mat-error *ngIf="productForm.get('categoryCtrl').hasError('required') && productForm.get('categoryCtrl').touched">
                            Este campo es obligatorio.
                        </mat-error>
                    </div>
                    
                    <div class="form-group">
                        <label>Subcategoría <span class="required">*</span></label>
                        <ng-select [items]="sub_catego$ | async" 
                                   bindLabel="name_subcategory" 
                                   bindValue="id" 
                                   [formControl]="subcategoryFilterCtrl" 
                                   formControlName="subcategoryCtrl" 
                                   [(ngModel)]="selectedSubcategory" 
                                   [disabled]="!selectedProdCate"
                                   [clearable]="true"
                                   required
                                   placeholder="Seleccionar subcategoría"
                                   notFoundText="No hay subcategorías disponibles">
                        </ng-select>
                        <mat-error *ngIf="productForm.get('subcategoryCtrl').hasError('required') && productForm.get('subcategoryCtrl').touched">
                            Este campo es obligatorio.
                        </mat-error>
                        <small *ngIf="selectedProdCate && (sub_catego$ | async)?.length === 0" style="color: #666; font-size: 12px; margin-top: 4px; display: block;">
                            No hay subcategorías disponibles para esta categoría. Por favor, selecciona otra categoría.
                        </small>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Marca <span class="required">*</span></label>
                        <input placeholder="Marca del producto" 
                               formControlName="brand" 
                               class="form-control" 
                               required 
                               maxlength="50">
                        <mat-error *ngIf="productForm.get('brand').hasError('required') && productForm.get('brand').touched">
                            Este campo es obligatorio.
                        </mat-error>
                    </div>
                    
                    <div class="form-group">
                        <label>Precio <span class="required">*</span></label>
                        <input placeholder="Precio del producto" 
                               formControlName="total_price" 
                               class="form-control" 
                               required 
                               maxlength="9">
                        <mat-error *ngIf="productForm.get('total_price').hasError('required') && productForm.get('total_price').touched">
                            Este campo es obligatorio.
                        </mat-error>
                        <mat-error *ngIf="productForm.controls['total_price'].hasError('pattern')">
                            Solo se aceptan números.
                        </mat-error>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group full-width">
                        <label>Descripción <span class="required">*</span></label>
                        <textarea placeholder="Descripción detallada del producto" 
                                  formControlName="description_product" 
                                  class="form-control textarea-field" 
                                  required 
                                  maxlength="500"
                                  rows="4"></textarea>
                        <mat-error *ngIf="productForm.get('description_product').hasError('required') && productForm.get('description_product').touched">
                            Este campo es obligatorio.
                        </mat-error>
                    </div>
                </div>
                        <div fxLayout='row wrap'>
                            <div fxFlex.xs="100" fxFlex.sm="100" fxFlex.md="100" fxFlex.lg="100" fxFlex.xl="100" class="relative img_up mt-3">
                                <ngx-dropzone (change)="selectFile($event)" 
                                              [multiple]="true" 
                                              [expandable]="true" 
                                              [disableClick]="false" 
                                              [accept]="'image/*'" 
                                              [maxFileSize]="10000000"
                                              class="dropzone-custom">
                                    <ngx-dropzone-label>
                                        <i class="material-icons">cloud_upload</i>
                                        <p>Arrastra las imágenes del producto aquí</p>
                                        <small>Formatos: JPG, PNG | Mínimo: 700px | Máximo: 10MB</small>
                                    </ngx-dropzone-label>
                                    <ngx-dropzone-image-preview ngProjectAs="ngx-dropzone-preview" *ngFor="let f of files" [file]="f" [removable]="true" (removed)="onRemove(f)">
                                        <ngx-dropzone-label>{{ f.name }} ({{ f.type }})</ngx-dropzone-label>
                                    </ngx-dropzone-image-preview>
                                </ngx-dropzone>

                                <div align="center" class="mt-3" *ngIf="validate_img">
                                    <label style="color:red">
                                                    La imagen debe tener formato jpg o png\n, tener más de 700 píxeles en uno de sus lados.
                                                </label>
                                </div>
                                <div align="center" class="mt-3" *ngIf="obligatory_img">
                                    <label style="color:red">
                                                    Cargar por lo menos una imagen del producto!
                                                </label>
                                </div>

                            </div>
                        </div>
                <div class="form-actions">
                    <button class="create-btn" 
                            mat-raised-button 
                            (click)="submitProductInfo()" 
                            [disabled]="btnDisabled">
                        <i class="material-icons">add</i>
                        Crear producto
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>
